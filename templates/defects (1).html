{% extends 'base.html' %}
{% block content %}
<div class="container py-4">
    <h2 class="mb-4 text-center">Defect Entry</h2>

    <!-- FG Part Number Input -->
    <div class="mb-3 row">
        <label for="fg_part_number" class="col-sm-2 col-form-label">FG Part Number</label>
        <div class="col-sm-6">
            <input type="text" id="fg_part_number" class="form-control" placeholder="ABC123456789" maxlength="12">
        </div>
        <div class="col-sm-4">
            <button type="button" onclick="fetchPartDetails(event)">Fetch</button>
        </div>
    </div>

    <!-- FG Part Name Display -->
    <div class="mb-3 row">
        <label class="col-sm-2 col-form-label">FG Part Name</label>
        <div class="col-sm-10">
            <input type="text" id="fg_part_name" class="form-control" readonly>
        </div>
    </div>

    <!-- Defect Details Form -->
    <div class="card p-3 shadow-sm mb-4">
        <h5 class="mb-3">Defect Details</h5>

        <div class="row g-3">
            <div class="col-md-3">
                <label>Defect Stage</label>
                <select id="defect_stage" class="form-select">SELECT</select>
            </div>
            <div class="col-md-3">
                <label>Defect Description</label>
                <select id="defect_description" class="form-select"></select>
            </div>
            <div class="col-md-3">
                <label>Line</label>
                <select id="line" class="form-select"></select>
            </div>
            <div class="col-md-3">
                <label>Supplier/Process</label>
                <select id="supplier_process" class="form-select">
                    <option value="Supplier">Supplier</option>
                    <option value="Process">Process</option>
                </select>
            </div>
            <div class="col-md-3">
                <label>Operator Name</label>
                <input type="text" id="operator_name" class="form-control">
            </div>
            <div class="col-md-3">
                <label>Inspector Code</label>
                <input type="text" id="inspector_code" class="form-control">
            </div>
            <div class="col-md-6">
                <label>Remarks</label>
                <input type="text" id="remarks" class="form-control">
            </div>
        </div>

        <div class="mt-3 text-end">
            <button class="btn btn-success" onclick="addEntry()">Add Entry</button>
        </div>
    </div>

    <!-- Entries Table -->
    <div class="table-responsive mb-4">
        <table class="table table-bordered table-striped" id="entries_table">
            <thead class="table-dark">
                <tr>
                    <th>Sr. No.</th>
                    <th>Date</th>
                    <th>Defect Stage</th>
                    <th>Defect Description</th>
                    <th>Line</th>
                    <th>Supplier/Process</th>
                    <th>Operator Name</th>
                    <th>Inspector Code</th>
                    <th>Remarks</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- Submit Button -->
    <div class="text-center">
        <button class="btn btn-primary" onclick="submitDefects()">Submit</button>
    </div>
</div>

<!-- Add New Part Modal -->
<div class="modal fade" id="addPartModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Add New Part</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <label for="new_part_number" class="form-label">FG Part Number</label>
        <input id="new_part_number" class="form-control" readonly>

        <label for="new_part_name" class="form-label mt-2">FG Part Name</label>
        <input id="new_part_name" class="form-control">
      </div>
      <div class="modal-footer">
        <!-- IMPORTANT: type="button" prevents unintended form submit/page reload -->
        <button type="button" id="saveNewPartBtn" class="btn btn-success">Save</button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
      </div>
    </div>
  </div>
</div>

<!-- Production Quantity Modal -->
<div class="modal fade" id="productionQuantityModal" tabindex="-1" aria-labelledby="productionQuantityLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Enter Production Quantity</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <input type="number" id="production_quantity" class="form-control" placeholder="Enter quantity">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success" onclick="confirmProductionQuantity()">Confirm</button>
            </div>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/defects.js') }}"></script>
{% endblock %}
